<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload IPA - Vthangios.vn</title>
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg">
    <link rel="icon" type="image/x-icon" href="/favicon/favicon.ico">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Vthangios">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'nu-primary': '#6366f1',
                        'nu-secondary': '#8b5cf6',
                        'nu-accent': '#06b6d4',
                        'nu-success': '#10b981',
                        'nu-warning': '#f59e0b',
                        'nu-error': '#ef4444',
                        'nu-gray': {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a'
                        }
                    },
                    fontFamily: {
                        'nu': ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif']
                    },
                    animation: {
                        'nu-fade-in': 'nu-fade-in 0.3s ease-out',
                        'nu-slide-up': 'nu-slide-up 0.4s ease-out',
                        'nu-scale': 'nu-scale 0.2s ease-out'
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes nu-fade-in {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes nu-slide-up {
            from { opacity: 0; transform: translateY(24px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes nu-scale {
            from { transform: scale(0.95); }
            to { transform: scale(1); }
        }
        .nu-card {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nu-glass {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nu-input {
            transition: all 0.2s ease;
            background: rgba(15, 23, 42, 0.5);
            border: 2px dashed rgba(100, 116, 139, 0.5);
            color: white;
        }
        .nu-input:focus {
            transform: translateY(-1px);
            box-shadow: 0 8px 25px -8px rgba(99, 102, 241, 0.3);
            border-color: rgba(6, 182, 212, 0.8);
        }
        .nu-input:hover {
            border-color: rgba(6, 182, 212, 0.5);
        }
        .nu-input::placeholder {
            color: rgba(148, 163, 184, 0.7);
        }
        .nu-button {
            transition: all 0.2s ease;
        }
        .nu-button:hover {
            transform: translateY(-1px);
        }
        .nu-button:active {
            transform: translateY(0);
        }
        
        .file-selected {
            border-color: #10b981 !important;
            background: rgba(16, 185, 129, 0.1);
        }
        
        @keyframes pulse-success {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .pulse-success {
            animation: pulse-success 0.6s ease-in-out;
        }
        
        /* Dark theme glow effects */
        .glow-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(40px);
            transition: all 0.5s ease;
            pointer-events: none;
        }
        
        .glow-orb-1 {
            top: -32px;
            left: -32px;
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(14, 165, 233, 0));
        }
        
        .glow-orb-2 {
            bottom: -32px;
            right: -32px;
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.2), rgba(6, 182, 212, 0));
        }
        
        @media (min-width: 768px) {
            .glow-orb-1 {
                top: -64px;
                left: -64px;
                width: 128px;
                height: 128px;
            }
            
            .glow-orb-2 {
                bottom: -64px;
                right: -64px;
                width: 128px;
                height: 128px;
            }
        }
        
        .step-card {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(71, 85, 105, 0.3);
            transition: all 0.3s ease;
        }
        
        .step-card:hover {
            border-color: rgba(6, 182, 212, 0.5);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px -2px rgba(6, 182, 212, 0.1);
        }
        
        @media (min-width: 768px) {
            .step-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px -5px rgba(6, 182, 212, 0.1);
            }
        }
        
        .file-icon {
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.2);
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .shimmer {
            animation: shimmer 2s infinite;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 font-nu text-white relative overflow-x-hidden">
    
    <!-- Background glow effects -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-cyan-500/10 rounded-full filter blur-3xl animate-pulse"></div>
        <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-sky-500/10 rounded-full filter blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
    </div>
    
    <!-- Main Container -->
    <div class="min-h-screen p-3 md:p-6 relative z-10">
        <div class="max-w-3xl mx-auto space-y-4 md:space-y-6">
            
            <!-- Navigation Header -->
            <nav class="animate-nu-fade-in">
                <div class="nu-card rounded-xl p-4 md:p-5">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                        <!-- Brand/Logo -->
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 md:w-10 md:h-10 bg-gradient-to-br from-cyan-500 to-sky-500 rounded-lg flex items-center justify-center shadow-lg shadow-cyan-500/25">
                                <svg class="w-4 h-4 md:w-5 md:h-5 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="17,8 12,3 7,8"/>
                                    <line x1="12" y1="3" x2="12" y2="15"/>
                                </svg>
                            </div>
                            <div>
                                <h1 class="text-lg md:text-xl font-bold bg-gradient-to-r from-cyan-400 to-sky-400 bg-clip-text text-transparent">
                                    Vthangios.vn
                                </h1>
                                <p class="text-xs text-slate-400">IPA Upload Service</p>
                            </div>
                        </div>
                        
                        <!-- Navigation Links -->
                        <div class="flex items-center gap-2 md:gap-3">
                            
                            
                            <a href="/" 
                               class="flex items-center gap-2 px-3 md:px-4 py-2 bg-slate-700/50 hover:bg-slate-600/50 text-white rounded-lg transition-all duration-300 hover:scale-105 text-sm font-medium">
                                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                    <circle cx="12" cy="16" r="1"/>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                </svg>
                                <span class="hidden sm:inline">KÃ½ IPA</span>
                                <span class="sm:hidden">Signing</span>
                            </a>
                        </div>
                    </div>
                </div>
            </nav>
            
            <!-- Header Section -->
            <header class="text-center py-4 md:py-6 animate-nu-fade-in">
                <div class="inline-flex items-center justify-center w-12 h-12 md:w-14 md:h-14 bg-gradient-to-br from-cyan-500 to-sky-500 rounded-xl mb-3 shadow-xl shadow-cyan-500/25">
                    <svg class="w-6 h-6 md:w-7 md:h-7 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17,8 12,3 7,8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                </div>
                <h1 class="text-2xl md:text-3xl lg:text-4xl font-bold bg-gradient-to-r from-cyan-400 to-sky-400 bg-clip-text text-transparent mb-2">
                    Upload IPA
                </h1>
                <p class="text-slate-400 text-sm md:text-base">Táº£i lÃªn vÃ  xá»­ lÃ½ file IPA cá»§a báº¡n</p>
            </header>

            <!-- Main Upload Card -->
            <div class="group relative animate-nu-fade-in">
                <div class="relative overflow-hidden rounded-xl md:rounded-2xl shadow-xl transition-all duration-300 hover:-translate-y-1 hover:shadow-cyan-500/10 nu-card">
                    <!-- Glow orbs -->
                    <div class="glow-orb glow-orb-1 group-hover:scale-150 group-hover:opacity-70"></div>
                    <div class="glow-orb glow-orb-2 group-hover:scale-150 group-hover:opacity-70"></div>
                    
                    <div class="relative p-4 md:p-6">
                        <!-- Upload Section -->
                        <div id="uploadArea" 
                             class="group/dropzone step-card rounded-lg md:rounded-xl p-6 md:p-8 text-center cursor-pointer mb-4 md:mb-6"
                             onclick="document.getElementById('fileInput').click()">
                            <div class="space-y-4 md:space-y-6">
                                <div class="w-16 h-16 md:w-20 md:h-20 mx-auto bg-gradient-to-br from-cyan-500 to-sky-500 rounded-xl flex items-center justify-center shadow-lg shadow-cyan-500/25">
                                    <svg class="w-8 h-8 md:w-10 md:h-10 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="17,8 12,3 7,8"/>
                                        <line x1="12" y1="3" x2="12" y2="15"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg md:text-xl font-bold mb-2 text-white">Táº£i lÃªn file IPA</h3>
                                    <p class="text-slate-400 text-sm md:text-base mb-4">Cháº¡m Äá» chá»n hoáº·c kÃ©o tháº£ file vÃ o ÄÃ¢y</p>
                                    <div class="inline-flex items-center space-x-2 text-xs md:text-sm text-slate-300 bg-slate-800/50 px-3 py-2 rounded-full">
                                        <svg class="w-3 h-3 md:w-4 md:h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"/>
                                            <path d="m9 12 2 2 4-4"/>
                                        </svg>
                                        <span>Tá»i Äa 500MB â¢ Chá» file .ipa</span>
                                    </div>
                                </div>
                            </div>
                            <input type="file" id="fileInput" accept=".ipa" class="hidden" />
                        </div>
                        
                        <!-- Upload Progress -->
                        <div id="progressSection" class="hidden">
                            <div class="step-card rounded-lg md:rounded-xl p-4 md:p-5 mb-4 md:mb-6">
                                <div class="text-center mb-4 md:mb-5">
                                    <h2 class="text-lg md:text-xl font-bold text-white mb-2" id="progressTitle">Äang xá»­ lÃ½...</h2>
                                    <p class="text-slate-400 text-sm" id="uploadFileName">filename.ipa</p>
                                </div>
                                
                                <div class="space-y-4 md:space-y-5">
                                    <!-- Overall Progress Bar -->
                                    <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-3 md:p-4">
                                        <div class="flex items-center justify-between mb-2 md:mb-3">
                                            <span class="text-xs md:text-sm font-medium text-white" id="progressLabel">Báº¯t Äáº§u xá»­ lÃ½</span>
                                            <span class="text-xs md:text-sm text-slate-400" id="uploadPercent">0%</span>
                                        </div>
                                        <div class="w-full bg-slate-800 rounded-full h-2 md:h-3 overflow-hidden">
                                            <div id="progressBar" 
                                                 class="bg-gradient-to-r from-cyan-500 via-cyan-400 to-sky-400 h-2 md:h-3 rounded-full transition-all duration-500 ease-out relative" 
                                                 style="width: 0%">
                                                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-pulse"></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Step Progress -->
                                    <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-3 md:p-4">
                                        <h4 class="text-xs md:text-sm font-medium text-white mb-3">Chi tiáº¿t xá»­ lÃ½:</h4>
                                        <div class="space-y-2">
                                            <!-- Step 1: Upload -->
                                            <div class="flex items-center space-x-3" id="step-upload">
                                                <div class="w-5 h-5 rounded-full border-2 border-slate-600 flex items-center justify-center flex-shrink-0">
                                                    <div class="w-2 h-2 rounded-full bg-slate-600"></div>
                                                </div>
                                                <div class="flex-1">
                                                    <span class="text-xs md:text-sm text-slate-400">1. Upload file IPA</span>
                                                </div>
                                                <div class="text-xs text-slate-500" id="step-upload-status">Chá»</div>
                                            </div>
                                            
                                            <!-- Step 2: Processing -->
                                            <div class="flex items-center space-x-3" id="step-processing">
                                                <div class="w-5 h-5 rounded-full border-2 border-slate-600 flex items-center justify-center flex-shrink-0">
                                                    <div class="w-2 h-2 rounded-full bg-slate-600"></div>
                                                </div>
                                                <div class="flex-1">
                                                    <span class="text-xs md:text-sm text-slate-400">2. Äang kÃ½ vÃ  xá»­ lÃ½ IPA</span>
                                                </div>
                                                <div class="text-xs text-slate-500" id="step-processing-status">Chá»</div>
                                            </div>
                                            
                                            <!-- Step 3: Generating -->
                                            <div class="flex items-center space-x-3" id="step-generating">
                                                <div class="w-5 h-5 rounded-full border-2 border-slate-600 flex items-center justify-center flex-shrink-0">
                                                    <div class="w-2 h-2 rounded-full bg-slate-600"></div>
                                                </div>
                                                <div class="flex-1">
                                                    <span class="text-xs md:text-sm text-slate-400">3. Táº¡o link cÃ i Äáº·t</span>
                                                </div>
                                                <div class="text-xs text-slate-500" id="step-generating-status">Chá»</div>
                                            </div>
                                            
                                            <!-- Step 4: Complete -->
                                            <div class="flex items-center space-x-3" id="step-complete">
                                                <div class="w-5 h-5 rounded-full border-2 border-slate-600 flex items-center justify-center flex-shrink-0">
                                                    <div class="w-2 h-2 rounded-full bg-slate-600"></div>
                                                </div>
                                                <div class="flex-1">
                                                    <span class="text-xs md:text-sm text-slate-400">4. HoÃ n thÃ nh</span>
                                                </div>
                                                <div class="text-xs text-slate-500" id="step-complete-status">Chá»</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-center">
                                        <div class="animate-spin rounded-full h-6 w-6 md:h-8 md:w-8 border-2 border-slate-600 border-t-cyan-500"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Loading Section -->
                        <div id="loadingSection" class="hidden">
                            <div class="step-card rounded-lg md:rounded-xl p-4 md:p-5 mb-4 md:mb-6">
                                <div class="text-center">
                                    <div class="animate-spin rounded-full h-6 w-6 md:h-8 md:w-8 border-2 border-cyan-500 border-t-transparent mx-auto mb-3"></div>
                                    <p class="text-slate-400 font-medium">Äang xá»­ lÃ½...</p>
                                </div>
                            </div>
                        </div>

                        <!-- Result Section -->
                        <div id="resultSection" class="hidden">
                            <div class="text-center mb-4 md:mb-5">
                                <div class="inline-flex items-center justify-center w-12 h-12 md:w-14 md:h-14 bg-emerald-500/20 rounded-full mb-3 md:mb-4">
                                    <svg class="w-6 h-6 md:w-7 md:h-7 text-emerald-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="20,6 9,17 4,12"/>
                                    </svg>
                                </div>
                                <h2 class="text-lg md:text-xl font-bold text-white mb-2">Upload thÃ nh cÃ´ng!</h2>
                                <p class="text-slate-400 text-sm">File IPA ÄÃ£ ÄÆ°á»£c xá»­ lÃ½ vÃ  sáºµn sÃ ng cÃ i Äáº·t</p>
                            </div>
                            
                            <div class="space-y-4">
                                <!-- App Info Card -->
                                <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-4">
                                    <h3 class="text-white font-semibold mb-3 flex items-center gap-2">
                                        <svg class="w-5 h-5 text-cyan-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                                            <line x1="8" y1="21" x2="16" y2="21"/>
                                            <line x1="12" y1="17" x2="12" y2="21"/>
                                        </svg>
                                        ThÃ´ng tin á»©ng dá»¥ng
                                    </h3>
                                    <div class="flex items-center space-x-4 mb-4">
                                        <div id="appIcon" 
                                             class="w-20 h-20 bg-slate-800 rounded-xl flex items-center justify-center flex-shrink-0 overflow-hidden border border-slate-600/50">
                                            <svg class="w-10 h-10 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="5" y="2" width="14" height="20" rx="2" ry="2"/>
                                                <line x1="12" y1="18" x2="12.01" y2="18"/>
                                            </svg>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <h4 id="appName" class="text-lg font-semibold text-white truncate mb-1">App Name</h4>
                                            <div class="space-y-1 text-sm text-slate-400">
                                                <p class="truncate"><span class="font-medium text-slate-300">Bundle ID:</span> <span id="bundleId" class="font-mono text-xs">-</span></p>
                                                <p><span class="font-medium text-slate-300">Version:</span> <span id="version">-</span> <span class="text-slate-500">(<span id="build">-</span>)</span></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Certificate Information Card -->
                                <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-4">
                                    <h3 class="text-white font-semibold mb-3 flex items-center gap-2">
                                        <svg class="w-5 h-5 text-amber-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                            <circle cx="12" cy="16" r="1"/>
                                            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                        </svg>
                                        ThÃ´ng tin chá»©ng chá»
                                    </h3>
                                    
                                    <div class="space-y-3 text-sm">
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <span class="text-slate-400 block mb-1">Team Name:</span>
                                                <span id="teamName" class="text-white font-medium">-</span>
                                            </div>
                                            <div>
                                                <span class="text-slate-400 block mb-1">Team ID:</span>
                                                <span id="teamId" class="text-white font-mono text-xs">-</span>
                                            </div>
                                        </div>
                                        
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <span class="text-slate-400 block mb-1">Loáº¡i chá»©ng chá»:</span>
                                                <span id="certType" class="text-white font-medium">-</span>
                                            </div>
                                            <div>
                                                <span class="text-slate-400 block mb-1">Tráº¡ng thÃ¡i:</span>
                                                <span id="certStatus" class="font-medium">-</span>
                                            </div>
                                        </div>
                                        
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <span class="text-slate-400 block mb-1">File Size:</span>
                                                <span id="fileSize" class="text-white font-medium">-</span>
                                            </div>
                                            <div>
                                                <span class="text-slate-400 block mb-1">Storage:</span>
                                                <span id="storageType" class="text-white font-medium uppercase">-</span>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <span class="text-slate-400 block mb-1">Háº¡n sá»­ dá»¥ng:</span>
                                            <div class="flex items-center justify-between">
                                                <span id="certExpiry" class="text-white font-mono text-xs">-</span>
                                                <span id="certDays" class="text-sm"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Install Link Card -->
                                <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-4">
                                    <h3 class="text-white font-semibold mb-3 flex items-center gap-2">
                                        <svg class="w-5 h-5 text-sky-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="7,10 12,15 17,10"/>
                                            <line x1="12" y1="15" x2="12" y2="3"/>
                                        </svg>
                                        CÃ i Äáº·t á»©ng dá»¥ng
                                    </h3>
                                    
                                    <!-- Install Link -->
                                    <div class="space-y-3">
                                        <div>
                                            <label class="text-slate-400 text-xs mb-1 block">Link cÃ i Äáº·t (itms):</label>
                                            <div class="flex gap-2">
                                                <input type="text" id="installUrl" readonly 
                                                       class="flex-1 px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white text-xs font-mono">
                                                <button onclick="copyToClipboard('installUrl')" 
                                                        class="px-3 py-2 bg-cyan-500 hover:bg-cyan-400 text-white rounded transition-colors">
                                                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                                    </svg>
                                                </button>
                                                <button onclick="shortenUrl('installUrl')" id="shortenBtn"
                                                        class="px-3 py-2 bg-emerald-500 hover:bg-emerald-400 text-white rounded transition-colors">
                                                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                                                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                                                    </svg>
                                                </button>
                                            </div>
                                            <div id="installUrlShort" class="hidden mt-2">
                                                <div class="flex items-center justify-between mb-2">
                                                    <span class="text-xs font-medium text-emerald-400">Link rÃºt gá»n:</span>
                                                    <button onclick="copyToClipboard('installUrlShortText')" 
                                                            class="px-2 py-1 bg-emerald-500/20 text-emerald-400 rounded text-xs font-medium transition-colors">
                                                        <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                                                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                                                        </svg>
                                                    </button>
                                                </div>
                                                <div id="installUrlShortText" 
                                                     class="bg-emerald-500/10 border border-emerald-500/30 p-2 rounded text-xs font-mono text-emerald-400">-</div>
                                            </div>
                                        </div>
                                        
                                        <!-- IPA Download Link -->
                                        <div>
                                            <label class="text-slate-400 text-xs mb-1 block">Link táº£i IPA:</label>
                                            <div class="flex gap-2">
                                                <input type="text" id="ipaDownloadUrl" readonly 
                                                       class="flex-1 px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white text-xs font-mono">
                                                <button onclick="copyToClipboard('ipaDownloadUrl')" 
                                                        class="px-3 py-2 bg-purple-500 hover:bg-purple-400 text-white rounded transition-colors">
                                                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                                    </svg>
                                                </button>
                                                <button onclick="window.open(document.getElementById('ipaDownloadUrl').value, '_blank')" 
                                                        class="px-3 py-2 bg-orange-500 hover:bg-orange-400 text-white rounded transition-colors">
                                                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                                        <polyline points="7,10 12,15 17,10"/>
                                                        <line x1="12" y1="15" x2="12" y2="3"/>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Actions -->
                                <div class="text-center">
                                    <div class="grid grid-cols-2 gap-3">
                                        <button onclick="resetUpload()" 
                                                class="flex items-center justify-center space-x-2 px-4 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-medium transition-colors">
                                            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="23 4 23 10 17 10"/>
                                                <polyline points="1 20 1 14 7 14"/>
                                                <path d="m3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                                            </svg>
                                            <span>Upload láº¡i</span>
                                        </button>
                                        <button onclick="openInstallPage()" 
                                                class="flex items-center justify-center space-x-2 px-4 py-3 bg-sky-500 hover:bg-sky-400 text-white rounded-lg font-medium transition-colors">
                                            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                                                <polyline points="15,3 21,3 21,9"/>
                                                <line x1="10" y1="14" x2="21" y2="3"/>
                                            </svg>
                                            <span>Má» trang</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Error Section -->
                        <div id="errorMessage" class="hidden">
                            <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-4">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-red-500/20 rounded-full flex items-center justify-center flex-shrink-0">
                                        <svg class="w-4 h-4 text-red-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"/>
                                            <line x1="15" y1="9" x2="9" y2="15"/>
                                            <line x1="9" y1="9" x2="15" y2="15"/>
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-medium text-red-400">CÃ³ lá»i xáº£y ra</h4>
                                        <p id="errorText" class="text-sm text-red-300">Error message</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer vá»i hÆ°á»ng dáº«n -->
    <footer class="relative z-10 mt-8 md:mt-12">
        <div class="max-w-3xl mx-auto px-3 md:px-6">
            <div class="nu-card rounded-xl p-4 md:p-6">
                <div class="text-center mb-4 md:mb-6">
                    <h3 class="text-lg md:text-xl font-bold text-white mb-2">ð CÃ¡ch hoáº¡t Äá»ng</h3>
                    <p class="text-slate-400 text-sm">Upload IPA ÄÃ£ kÃ½ vÃ  nháº­n link cÃ i Äáº·t trá»±c tiáº¿p cho iOS</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-6">
                    <!-- Step 1 -->
                    <div class="text-center">
                        <div class="w-12 h-12 bg-gradient-to-br from-cyan-500 to-sky-500 rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg shadow-cyan-500/25">
                            <span class="text-white font-bold text-lg">1</span>
                        </div>
                        <h4 class="font-semibold text-white mb-2">Upload IPA</h4>
                        <p class="text-xs md:text-sm text-slate-400">Upload file .ipa ÄÃ£ kÃ½ báº±ng chá»©ng chá» doanh nghiá»p</p>
                    </div>
                    
                    <!-- Step 2 -->
                    <div class="text-center">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg shadow-purple-500/25">
                            <span class="text-white font-bold text-lg">2</span>
                        </div>
                        <h4 class="font-semibold text-white mb-2">Táº¡o manifest</h4>
                        <p class="text-xs md:text-sm text-slate-400">Há» thá»ng tá»± Äá»ng táº¡o manifest vÃ  link cÃ i Äáº·t</p>
                    </div>
                    
                    <!-- Step 3 -->
                    <div class="text-center">
                        <div class="w-12 h-12 bg-gradient-to-br from-emerald-500 to-green-500 rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg shadow-emerald-500/25">
                            <span class="text-white font-bold text-lg">3</span>
                        </div>
                        <h4 class="font-semibold text-white mb-2">CÃ i Äáº·t ngay</h4>
                        <p class="text-xs md:text-sm text-slate-400">Copy link vÃ  cÃ i Äáº·t trá»±c tiáº¿p trÃªn iPhone/iPad</p>
                    </div>
                </div>
                
                <!-- Technical Info -->
                <div class="bg-slate-900/50 rounded-lg p-4 mb-4">
                    <h4 class="font-semibold text-white mb-3 flex items-center gap-2">
                        <svg class="w-4 h-4 text-cyan-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="m9 12 2 2 4-4"/>
                        </svg>
                        YÃªu cáº§u
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-xs md:text-sm text-slate-400">
                        <div>
                            <span class="font-medium text-slate-300">ð± Thiáº¿t bá»:</span>
                            <p>iPhone/iPad báº¥t ká»³</p>
                        </div>
                        <div>
                            <span class="font-medium text-slate-300">ð TrÃ¬nh duyá»t:</span>
                            <p>Safari Äá» cÃ i Äáº·t</p>
                        </div>
                        <div>
                            <span class="font-medium text-slate-300">ð File IPA:</span>
                            <p>ÄÃ£ kÃ½ báº±ng Enterprise Certificate</p>
                        </div>
                        <div>
                            <span class="font-medium text-slate-300">â¡ Tá»c Äá»:</span>
                            <p>Táº¡o link cÃ i Äáº·t trong vÃ i giÃ¢y</p>
                        </div>
                    </div>
                </div>
                
                
                
                <!-- Copyright -->
                <div class="text-center mt-6 pt-4 border-t border-slate-700">
                    <p class="text-xs text-slate-500">
                        Â© 2025 Vthangios.vn. Made with â¤ï¸ for iOS community.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        let currentFileId = null;
        let currentData = null;

        // File input event
        document.getElementById('fileInput').addEventListener('change', handleFileSelect);

        // Drag and drop events
        const uploadArea = document.getElementById('uploadArea');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('step-card');
            uploadArea.classList.add('border-cyan-500', 'bg-cyan-500/10');
        });

        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-cyan-500', 'bg-cyan-500/10');
            uploadArea.classList.add('step-card');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-cyan-500', 'bg-cyan-500/10');
            uploadArea.classList.add('step-card');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            if (!file.name.toLowerCase().endsWith('.ipa')) {
                showError('Vui lÃ²ng chá»n file .ipa');
                return;
            }

            if (file.size > 500 * 1024 * 1024) {
                showError('File quÃ¡ lá»n. KÃ­ch thÆ°á»c tá»i Äa lÃ  500MB');
                return;
            }

            uploadFile(file);
        }

        async function uploadFile(file) {
            showProgress(true, file.name);
            hideError();
            hideResult();

            const formData = new FormData();
            formData.append('ipaFile', file);

            try {
                // Step 1: Start upload
                updateProgressStep('upload', 'active', 'Äang táº£i lÃªn...');
                updateProgress(10, 'Äang táº£i file lÃªn server...');
                
                // Simulate upload progress
                let progress = 10;
                const uploadInterval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress > 40) progress = 40;
                    updateProgress(progress, 'Äang táº£i file lÃªn server...');
                }, 300);

                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });

                clearInterval(uploadInterval);
                
                // Step 1: Complete upload
                updateProgressStep('upload', 'complete', 'HoÃ n thÃ nh');
                updateProgress(50, 'Upload thÃ nh cÃ´ng');
                
                // Step 2: Processing
                updateProgressStep('processing', 'active', 'Äang xá»­ lÃ½...');
                updateProgress(60, 'Äang kÃ½ vÃ  xá»­ lÃ½ IPA...');
                
                // Simulate processing time
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Step 2: Complete processing
                updateProgressStep('processing', 'complete', 'HoÃ n thÃ nh');
                updateProgress(80, 'Xá»­ lÃ½ IPA thÃ nh cÃ´ng');
                
                // Step 3: Generating links
                updateProgressStep('generating', 'active', 'Äang táº¡o...');
                updateProgress(90, 'Äang táº¡o link cÃ i Äáº·t...');
                
                const result = await response.json();
                
                // Simulate link generation time
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // Step 3: Complete generating
                updateProgressStep('generating', 'complete', 'HoÃ n thÃ nh');
                updateProgress(95, 'Táº¡o link thÃ nh cÃ´ng');
                
                // Step 4: Complete all
                updateProgressStep('complete', 'complete', 'HoÃ n thÃ nh');
                updateProgress(100, 'Xá»­ lÃ½ hoÃ n táº¥t');

                setTimeout(() => {
                    showProgress(false);
                    if (result.success) {
                        showResult(result, file);
                    } else {
                        showError(result.error || 'CÃ³ lá»i xáº£y ra khi xá»­ lÃ½ file');
                    }
                }, 1000);

            } catch (error) {
                // Mark current step as error - find which step is currently active
                const steps = ['upload', 'processing', 'generating', 'complete'];
                let errorStep = 'upload'; // default to first step
                
                for (const step of steps) {
                    const statusElement = document.getElementById(`step-${step}-status`);
                    if (statusElement && statusElement.textContent && 
                        (statusElement.textContent.includes('Äang') || statusElement.classList.contains('text-cyan-400'))) {
                        errorStep = step;
                        break;
                    }
                }
                
                updateProgressStep(errorStep, 'error', 'Lá»i');
                
                showProgress(false);
                showError('KhÃ´ng thá» upload file: ' + error.message);
            }
        }

        function updateProgressStep(step, status, statusText) {
            console.log(`ð§ updateProgressStep: ${step} -> ${status} (${statusText})`);
            
            const stepElement = document.getElementById(`step-${step}`);
            const statusElement = document.getElementById(`step-${step}-status`);
            
            if (!stepElement || !statusElement) {
                console.warn(`â Step element not found: step-${step}`);
                console.warn(`stepElement:`, stepElement);
                console.warn(`statusElement:`, statusElement);
                return;
            }
            
            const circle = stepElement.querySelector('.w-5.h-5');
            const text = stepElement.querySelector('span');
            
            if (!circle || !text) {
                console.warn(`Circle or text element not found in step-${step}`);
                return;
            }
            
            // Reset all states first
            circle.className = 'w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0';
            
            // Remove existing dot if any
            const existingDot = circle.querySelector('.w-2.h-2');
            if (existingDot) {
                existingDot.remove();
            }
            
            switch (status) {
                case 'active':
                    circle.classList.add('border-cyan-500', 'bg-cyan-500/20');
                    text.classList.remove('text-slate-400');
                    text.classList.add('text-cyan-400');
                    statusElement.textContent = statusText;
                    statusElement.className = 'text-xs text-cyan-400';
                    
                    // Add spinning icon for active state
                    circle.innerHTML = `<svg class="w-3 h-3 text-cyan-500 animate-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
                    </svg>`;
                    break;
                    
                case 'complete':
                    circle.classList.add('border-emerald-500', 'bg-emerald-500/20');
                    text.classList.remove('text-slate-400');
                    text.classList.add('text-emerald-400');
                    statusElement.textContent = statusText;
                    statusElement.className = 'text-xs text-emerald-400';
                    
                    // Add check icon for complete state
                    circle.innerHTML = `<svg class="w-3 h-3 text-emerald-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20,6 9,17 4,12"/>
                    </svg>`;
                    break;
                    
                case 'error':
                    circle.classList.add('border-red-500', 'bg-red-500/20');
                    text.classList.remove('text-slate-400');
                    text.classList.add('text-red-400');
                    statusElement.textContent = statusText;
                    statusElement.className = 'text-xs text-red-400';
                    
                    // Add error icon
                    circle.innerHTML = `<svg class="w-3 h-3 text-red-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>`;
                    break;
                    
                case 'waiting':
                    circle.classList.add('border-slate-600');
                    text.classList.remove('text-cyan-400', 'text-emerald-400', 'text-red-400');
                    text.classList.add('text-slate-400');
                    statusElement.textContent = statusText;
                    statusElement.className = 'text-xs text-slate-500';
                    
                    // Add default dot for waiting state
                    circle.innerHTML = `<div class="w-2 h-2 rounded-full bg-slate-600"></div>`;
                    break;
                    
                default:
                    circle.classList.add('border-slate-600');
                    text.classList.remove('text-cyan-400', 'text-emerald-400', 'text-red-400');
                    text.classList.add('text-slate-400');
                    statusElement.textContent = statusText;
                    statusElement.className = 'text-xs text-slate-500';
                    
                    // Add default dot
                    circle.innerHTML = `<div class="w-2 h-2 rounded-full bg-slate-600"></div>`;
            }
        }

        function showProgress(show, fileName = '') {
            console.log('ð¯ showProgress called:', { show, fileName });
            const section = document.getElementById('progressSection');
            
            if (!section) {
                console.error('â progressSection element not found!');
                return;
            }
            
            if (show) {
                console.log('ð¤ Showing progress section');
                document.getElementById('uploadFileName').textContent = fileName;
                document.getElementById('progressTitle').textContent = 'Äang xá»­ lÃ½...';
                
                // Reset all steps
                console.log('ð Resetting all progress steps');
                updateProgressStep('upload', 'waiting', 'Chá»');
                updateProgressStep('processing', 'waiting', 'Chá»');
                updateProgressStep('generating', 'waiting', 'Chá»');
                updateProgressStep('complete', 'waiting', 'Chá»');
                
                section.classList.remove('hidden');
                console.log('â Progress section shown');
            } else {
                console.log('ð¥ Hiding progress section');
                section.classList.add('hidden');
            }
        }

        function updateProgress(percent, label) {
            const progressBar = document.getElementById('progressBar');
            const percentText = document.getElementById('uploadPercent');
            const labelText = document.getElementById('progressLabel');
            
            progressBar.style.width = percent + '%';
            percentText.textContent = Math.round(percent) + '%';
            labelText.textContent = label;
        }

        function showResult(data, file) {
            currentFileId = data.fileId;
            currentData = data;
            
            // Update app info
            document.getElementById('appName').textContent = data.appName || 'Unknown App';
            document.getElementById('bundleId').textContent = data.bundleId || 'N/A';
            document.getElementById('version').textContent = data.version || 'N/A';
            document.getElementById('build').textContent = data.buildVersion || 'N/A';

            // Enhanced certificate info display - handle based on embedded.mobileprovision
            console.log('ð Certificate data received:', data.certificateInfo);
            console.log('ð Signed status:', data.signed);
            console.log('ð Full data object:', data);
            
            // Check if we have valid certificate info from embedded.mobileprovision
            if (data.certificateInfo && 
                data.certificateInfo.teamName && 
                data.certificateInfo.teamName !== 'Unknown' &&
                data.certificateInfo.teamName !== 'DECRYPT' &&
                data.certificateInfo.teamName !== 'IPA Decrypt') {
                
                // IPA cÃ³ embedded.mobileprovision - hiá»n thá» thÃ´ng tin P12 chi tiáº¿t
                const certInfo = data.certificateInfo;
                
                // Handle different naming conventions for team info
                const teamName = certInfo.teamName || certInfo.team_name || 'Unknown Team';
                const teamId = certInfo.teamId || certInfo.team_id || 'Unknown ID';
                const certType = certInfo.certificateType || certInfo.certificate_type || 'Enterprise';
                const certStatus = certInfo.status || 'Há»£p lá»';
                const certExpiry = certInfo.expiryDate || certInfo.expiry_date || 'Unknown';
                
                console.log('ð Parsed certificate values:', { teamName, teamId, certType, certStatus, certExpiry });
                
                document.getElementById('teamName').textContent = teamName;
                document.getElementById('teamId').textContent = teamId;
                document.getElementById('certType').textContent = certType;
                document.getElementById('certStatus').textContent = certStatus;
                document.getElementById('certExpiry').textContent = certExpiry;
                
                // Update status color based on validity and signed status
                const statusElement = document.getElementById('certStatus');
                const isValid = certInfo.isValid !== false && certInfo.is_valid !== false && certStatus !== 'Invalid';
                
                if (isValid) {
                    statusElement.className = 'text-green-600 font-medium';
                } else {
                    statusElement.className = 'text-red-600 font-medium';
                }
                
                // Show days until expiry with improved handling
                const daysUntilExpiry = certInfo.daysUntilExpiry || certInfo.days_until_expiry;
                if (daysUntilExpiry !== null && daysUntilExpiry !== undefined) {
                    const daysElement = document.getElementById('certDays');
                    if (daysUntilExpiry > 0) {
                        daysElement.textContent = `${daysUntilExpiry} ngÃ y cÃ²n láº¡i`;
                        daysElement.className = daysUntilExpiry > 30 ? 'text-green-600 text-sm' : 
                                              daysUntilExpiry > 7 ? 'text-yellow-600 text-sm' : 'text-orange-600 text-sm';
                    } else {
                        daysElement.textContent = `ÄÃ£ háº¿t háº¡n ${Math.abs(daysUntilExpiry)} ngÃ y`;
                        daysElement.className = 'text-red-600 text-sm';
                    }
                } else {
                    document.getElementById('certDays').textContent = '';
                }
                
                console.log('â Certificate info displayed (cÃ³ embedded.mobileprovision):', { teamName, teamId, certType, certStatus });
                
            } else {
                // IPA khÃ´ng cÃ³ embedded.mobileprovision hoáº·c lÃ  decrypt
                console.log('â ï¸ No embedded.mobileprovision found - IPA decrypt');
                
                document.getElementById('teamName').textContent = '-';
                document.getElementById('teamId').textContent = '-';
                document.getElementById('certType').textContent = '-';
                document.getElementById('certStatus').textContent = 'IPA Decrypt';
                document.getElementById('certExpiry').textContent = '-';
                
                // Update status color for decrypt IPA
                const statusElement = document.getElementById('certStatus');
                statusElement.className = 'text-orange-500 font-medium';
                
                // Clear days info
                document.getElementById('certDays').textContent = '';
            }

            // Update additional info
            document.getElementById('fileSize').textContent = data.fileSize || 'Unknown';
            document.getElementById('storageType').textContent = data.storage || 'Local';

            // Update install URL (itms link)
            if (data.installUrl) {
                document.getElementById('installUrl').value = data.installUrl;
            } else {
                // Fallback if installUrl is not provided
                const fallbackInstallUrl = `${window.location.origin}/${data.fileId}`;
                document.getElementById('installUrl').value = fallbackInstallUrl;
            }
            
            // Update IPA download URL
            if (data.ipaDownloadUrl) {
                document.getElementById('ipaDownloadUrl').value = data.ipaDownloadUrl;
            } else if (data.url) {
                document.getElementById('ipaDownloadUrl').value = data.url;
            }

            // Show app icon if available
            const iconElement = document.getElementById('appIcon');
            if (data.iconUrl) {
                const testImg = new Image();
                testImg.onload = function() {
                    iconElement.innerHTML = `<img src="${this.src}" class="w-full h-full object-cover rounded-lg shadow-lg" alt="App Icon" />`;
                };
                testImg.onerror = function() {
                    // Fallback to default icon
                    iconElement.innerHTML = `<svg class="w-8 h-8 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="5" y="2" width="14" height="20" rx="2" ry="2"/>
                        <line x1="12" y1="18" x2="12.01" y2="18"/>
                    </svg>`;
                };
                testImg.src = data.iconUrl;
            } else {
                // No icon data available - show default icon with better styling
                iconElement.innerHTML = `<div class="w-full h-full bg-gradient-to-br from-slate-700 to-slate-600 rounded-lg flex items-center justify-center border border-slate-500/30">
                    <svg class="w-8 h-8 text-slate-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="5" y="2" width="14" height="20" rx="2" ry="2"/>
                        <line x1="12" y1="18" x2="12.01" y2="18"/>
                    </svg>
                </div>`;
            }

            document.getElementById('resultSection').classList.remove('hidden');
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function showLoading(show) {
            if (show) {
                document.getElementById('loadingSection').classList.remove('hidden');
            } else {
                document.getElementById('loadingSection').classList.add('hidden');
            }
        }

        function hideResult() {
            document.getElementById('resultSection').classList.add('hidden');
        }

        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorMessage').classList.remove('hidden');
        }

        function hideError() {
            document.getElementById('errorMessage').classList.add('hidden');
        }

        function toggleManifest() {
            const content = document.getElementById('manifestContent');
            const chevron = document.getElementById('manifestChevron');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                chevron.style.transform = 'rotate(180deg)';
            } else {
                content.classList.add('hidden');
                chevron.style.transform = 'rotate(0deg)';
            }
        }

        function toggleDetails() {
            const section = document.getElementById('detailsSection');
            const btn = document.getElementById('detailsToggleText');
            
            if (section.classList.contains('hidden')) {
                section.classList.remove('hidden');
                btn.textContent = 'áº¨n';
            } else {
                section.classList.add('hidden');
                btn.textContent = 'Hiá»n';
            }
        }

        function resetUpload() {
            // Reset all states
            hideResult();
            hideError();
            showProgress(false);
            currentFileId = null;
            currentData = null;
            
            // Reset file input
            document.getElementById('fileInput').value = '';
            
            // Add some visual feedback
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.classList.add('pulse-success');
            setTimeout(() => {
                uploadArea.classList.remove('pulse-success');
            }, 600);
        }

        function shareApp() {
            if (!currentData) return;
            
            const installPageUrl = `${window.location.origin}/${currentData.fileId}`;
            const appName = currentData.ipaInfo.bundleDisplayName || currentData.ipaInfo.bundleName || 'iOS App';
            
            if (navigator.share) {
                navigator.share({
                    title: `CÃ i Äáº·t ${appName}`,
                    text: `CÃ i Äáº·t á»©ng dá»¥ng ${appName} trÃªn iPhone cá»§a báº¡n`,
                    url: installPageUrl
                }).catch(console.error);
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(installPageUrl).then(() => {
                    const btn = event.target.closest('button');
                    const originalText = btn.innerHTML;
                    btn.innerHTML = `<svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20,6 9,17 4,12"/>
                    </svg><span>ÄÃ£ copy!</span>`;
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                    }, 2000);
                });
            }
        }

        async function shortenUrl(elementId) {
            const element = document.getElementById(elementId);
            const url = element.value || element.textContent.trim();
            const btn = event.target;
            
            if (!url || url === '-') {
                return;
            }

            // Show loading state
            const originalText = btn.innerHTML;
            btn.innerHTML = `<svg class="w-3 h-3 animate-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
            </svg>`;
            btn.disabled = true;

            try {
                const response = await fetch('/api/shorten-url', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url: url })
                });

                const result = await response.json();

                if (result.success) {
                    // Show shortened URL
                    const shortSection = document.getElementById(elementId + 'Short');
                    const shortText = document.getElementById(elementId + 'ShortText');
                    
                    shortText.textContent = result.shortUrl;
                    shortSection.classList.remove('hidden');
                    
                    // Show success state
                    btn.innerHTML = `<svg class="w-4 h-4 text-emerald-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20,6 9,17 4,12"/>
                    </svg>`;
                    btn.classList.add('bg-emerald-500/20', 'text-emerald-400');
                    
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.classList.remove('bg-emerald-500/20', 'text-emerald-400');
                        btn.disabled = false;
                    }, 3000);
                } else {
                    throw new Error(result.error || 'KhÃ´ng thá» rÃºt gá»n link');
                }
            } catch (error) {
                console.error('Error shortening URL:', error);
                
                // Show error state
                btn.innerHTML = 'â Lá»i';
                btn.classList.add('bg-red-500/20', 'text-red-400');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('bg-red-500/20', 'text-red-400');
                    btn.disabled = false;
                }, 3000);
            }
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            if (!element) {
                console.error('Element not found:', elementId);
                alert('KhÃ´ng thá» copy: element khÃ´ng tá»n táº¡i');
                return;
            }
            
            const text = element.value || element.textContent;
            if (!text) {
                console.error('No text to copy from element:', elementId);
                alert('KhÃ´ng cÃ³ text Äá» copy');
                return;
            }
            
            // Try modern clipboard API first
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showCopySuccess();
                }).catch(err => {
                    console.error('Clipboard API failed:', err);
                    fallbackCopy(text);
                });
            } else {
                // Fallback for older browsers
                fallbackCopy(text);
            }
            
            function showCopySuccess() {
                const btn = event.target.closest('button');
                if (btn) {
                    const originalText = btn.innerHTML;
                    btn.innerHTML = `<svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20,6 9,17 4,12"/>
                    </svg>`;
                    btn.classList.add('bg-emerald-500', 'hover:bg-emerald-400');
                    
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.classList.remove('bg-emerald-500', 'hover:bg-emerald-400');
                    }, 1000);
                }
                
                // Show toast notification
                showToast('â ÄÃ£ copy link!');
            }
            
            function fallbackCopy(text) {
                // Create temporary textarea
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        showCopySuccess();
                    } else {
                        throw new Error('Copy command failed');
                    }
                } catch (err) {
                    console.error('Fallback copy failed:', err);
                    // Manual copy prompt as last resort
                    prompt('Copy link nÃ y:', text);
                } finally {
                    document.body.removeChild(textarea);
                }
            }
        }
        
        function showToast(message) {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-emerald-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-all duration-300 transform translate-x-full';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);
            
            // Animate out and remove
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 2000);
        }

        function openInstallPage() {
            if (!currentData) return;
            const installPageUrl = `${window.location.origin}/${currentData.fileId}`;
            window.open(installPageUrl, '_blank');
        }

    </script>
</body>
</html>